steps:
# credentials are required.
#- name: 'gcr.io/cloud-builders/git'
 # args: ['clone', 'https://github.com/GoogleCloudPlatform/cloud-builders']
# This step uses Application Default Credentials to clone a Cloud Source
  
#First Clone from Google Cloud Source Repository  
#- name: 'gcr.io/cloud-builders/git'
  #args: ['clone','https://source.developers.google.com/p/${_PROJECT}/r/${_REPO_NAME}']

#Build the image 
- name: 'gcr.io/cloud-builders/docker'
  args: ['build','-t','gcr.io/$PROJECT_ID/adminapi:$REVISION_ID','.']

#Push the image  
- name: 'gcr.io/cloud-builders/docker'
  args: ['push','gcr.io/$PROJECT_ID/adminapi:$REVISION_ID']
  
#Update the container image using kubectl set
- name: 'gcr.io/cloud-builders/kubectl'
  args:
  - 'set'
  - '--namespace'
  - 'mqa'
  - 'image'
  - 'deployment/adminapi'
  - 'adminapi=gcr.io/$PROJECT_ID/adminapi:$REVISION_ID'
 
  env:
  - 'CLOUDSDK_COMPUTE_ZONE=us-central1-a'
  - 'CLOUDSDK_CONTAINER_CLUSTER=demo-mdev-mqa'
  
#substitutions:
    #GCP Specific configuration. Please DON'T change anything
    #_PROJECT: My-kubernates-Project
    #_PROJECT: my-kubernates-project-338709
    #_ZONE: us-central1-a
    #_GKE_CLUSTER: demo-mdev-mqa
    
    #Repository Specific configuration. DevOps can change this settings
    #_DEPLOYMENTNAME: adminapi
    #_CONTAINERNAME: adminapi   
    #_REPO_NAME: docker-repo
    
    # Developers ONLY change
    #_VERSION: v1.0
timeout: 10000s
